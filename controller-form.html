<!--
*
Class what encapsulating all form components
*
-->
<link rel="import" href="facade-form.html">
<link rel="import" href="form-data.html">
<link rel="import" href="form-list.html">
<link rel="import" href="form-form.html">

<dom-module id='controller-form'>
    <app-location route='{{route}}'></app-location>
    <app-route route='{{route}}' pattern='/:page' data='{{routeData}}' tail='{{subroute}}'></app-route>
    <template>
        <style is='custom-style '>
            .flex-stretch-align {
                @apply(--layout-horizontal);
                height: 100%;
            }

            .flex-stretch-vertical {
                @apply(--layout-vertical);
                height: 100%;
            }

            .dataform,
            .datalist {
                @apply(--layout-flex-1);
            }

            #list {
                --iron-data-table-header: {
                    z-index: 0;
                }
            }

            #form {
                display: flex;
                flex-direction: row;
                flex-wrap: wrap;
                align-content: flex-start;
                --paper-input-container: {
                    padding: 15px;
                }
                --paper-checkbox: {
                    padding: 15px;
                }
            }

            paper-item {
                --paper-item: {
                    cursor: pointer;
                }
            }

            .horizontal-section {
                padding: 0 !important;
            }
        </style>
        <form-data id='formData' items='{{items}}'></form-data>
        <paper-toast id="notifyTost" text="Default text"></paper-toast>
        <paper-drawer-panel force-narrow>
            <paper-header-panel drawer>
                <paper-toolbar>
                    <div>Change your application</div>
                </paper-toolbar>
                <div class="horizontal-section">
                    <paper-listbox>
                        <paper-item>Item 1</paper-item>
                        <paper-item>Item 2</paper-item>
                        <paper-item>Item 3</paper-item>
                        <paper-item>Item 4</paper-item>
                        <paper-item>Item 5</paper-item>
                        <paper-item>Item 6</paper-item>
                        <paper-item>Item 7</paper-item>
                        <paper-item>Item 8</paper-item>
                    </paper-listbox>
                </div>
            </paper-header-panel>
            <paper-header-panel main>
                <paper-toolbar>
                    <paper-icon-button icon='menu' paper-drawer-toggle id='superimp'></paper-icon-button>
                    <div class='middle title'>Title</div>
                    <div class='spacer'></div>
                    <paper-icon-button on-tap="handleSave" icon='save'></paper-icon-button>
                    <paper-icon-button on-tap="handleAdd" icon='add'></paper-icon-button>
                    <paper-icon-button on-tap="handleRemove" icon='remove'></paper-icon-button>
                    <paper-icon-button on-tap="handleCopy" icon='content-copy'></paper-icon-button>
                    <paper-icon-button on-tap="handlePaste" icon='content-paste'></paper-icon-button>
                    <paper-icon-button on-tap="handleRefresh" icon='refresh'></paper-icon-button>
                    <div class='spacer'></div>
                    <paper-tabs selected='0' scrollable autoselect-delay='300' style='width: 600px;'>
                        <paper-tab>Worckflow Scheme</paper-tab>
                        <paper-tab>Fields</paper-tab>
                        <paper-tab>Form</paper-tab>
                        <paper-tab>Security</paper-tab>
                        <paper-tab>E-mail Notifications</paper-tab>
                        <paper-tab>Export Settings</paper-tab>
                        <paper-tab>CSV Import</paper-tab>
                        <paper-tab>Event triggers</paper-tab>
                    </paper-tabs>
                </paper-toolbar>
                <div class='container flex-stretch-align'>
                    <form-list class='datalist flex-stretch-vertical' id='list' items='[[items]]' selected='[[selected]]' selectedItem='[[selected]]' style='flex:1;'></form-list>
                    <form-form class='dataform container flex-stretch-vertical' id='form' items='[[items]]' selected='[[selected]]' style='flex:1;'></form-form>
                </div>
            </paper-header-panel>
        </paper-drawer-panel>
    </template>
    <style>
        #paperDrawerPanel [main] {
            text-align: center;
            background-color: var(--google-grey-100);
        }

        #paperDrawerPanel [drawer] {
            border-right: 1px solid var(--google-grey-300);
        }

        #paperDrawerPanel[right-drawer] [drawer] {
            border-left: 1px solid var(--google-grey-300);
        }

        .spacer {
            @apply(--layout-flex);
        }
    </style>
    </template>
    <script>
        Polymer({
            is: 'controller-form',

            properties: {
                selectedItem: {
                    type: Number
                },
                items: {
                    type: Array,
                    notify: true
                }
            },

            listeners: {
                'items-loaded': '_loadDataToList',
                'change-selection': '_loadDataToForm'
            },

            handleRemove: function() {
                this.items.splice(this.selectedItem, 1)
                this.$.list.setItems(this.items)
                this.$.notifyTost.text = 'Item removed'
                this.$.notifyTost.open();
            },

            _loadDataToList: function(event) {
                var items = event.detail.items
                if (items && items.length > 0) {
                    this.$.list.setItems(items)
                }
            },

            handleRefresh: function() {
                //  this.items.splice(this.selectedItem,1)
            },

            handleSave: function() {
                this.$.formData.set('form-data', this.items)
            },

            _loadDataToForm: function(event) {
                var item = event.detail.item
                this.selectedItem = this.items.indexOf(item);
                if (item && item.length > 0) {
                    this.$.form.setData(item)
                }
            }
        });
    </script>
</dom-module>
