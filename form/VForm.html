<!--
*
Component - form
*
-->
<dom-module id='v-form'>
    <template>
        <style is='custom-style'>
            .flex-stretch-horizontal {
                @apply(--layout-horizontal);
                height: 100%;
            }

            .flex-stretch-vertical {
                @apply(--layout-vertical);
                height: 100%;
            }

            #checkbox {
                display: flex;
                align-items: flex-end;
                align-content: center;
                justify-content: center;
                margin-bottom: 15px;
            }
        </style>
        <template is='dom-repeat' items='{{formData}}' as='item'>
            <template item={{item}} is='dom-if' if='{{isSimpleField(item.field.type)}}'>
                <paper-input-container style$='{{computeContainerClass(item.layout.flex)}}'>
                    <label>{{item.field.label}}</label>
                    <input is='iron-input' bind-value='{{item.field.value}}' type={{item.field.type}}>
                </paper-input-container>
            </template>
            <template item={{item}} is='dom-if' if='{{isCheckbox(item.field.type)}}'>
                <paper-checkbox id='checkbox' auto-validate checked='{{item.field.value}}' style$='{{computeContainerClass(item.layout.flex)}}'>{{item.field.label}}</paper-checkbox>
            </template>
            <template item={{item}} is='dom-if' if='{{isPhone(item.field.type)}}'>
                <gold-phone-input auto-validate label='{{item.field.label}}' value='{{item.field.value}}' style$='{{computeContainerClass(item.layout.flex)}}'></gold-phone-input>
            </template>
            <template item={{item}} is='dom-if' if='{{isMail(item.field.type)}}'>
                <gold-email-input auto-validate label='{{item.field.label}}' value='{{item.field.value}}' style$='{{computeContainerClass(item.layout.flex)}}'></gold-email-input>
            </template>
            <template item={{item}} is='dom-if' if='{{isList(item.field.type)}}'>
                <paper-dropdown-menu label='{{item.field.label}}'>
                    <paper-listbox class="dropdown-content">
                        <template is='dom-repeat' items='{{item.field.values}}'>
                            <paper-item>{{item.value}}</paper-item>
                        </template>
                    </paper-listbox>
                </paper-dropdown-menu>
            </template>
        </template>
    </template>
    <script>
        Polymer({
            is: 'v-form',

            properties: {
                formData: {
                    type: Array
                },

                formChanges: {
                    type: Object,
                    value: {}
                }
            },

            observers: [
                'formDataChanged(formData.*)'
            ],

            formDataChanged: function(data) {
                //gaver form changes + some validation
                var propertyId = this.get(data.path.replace('value', 'id'))
                if (typeof propertyId === 'string') {
                    this.formChanges[data.path] = {
                        id: propertyId,
                        value: data.value
                    }
                }
            },

            computeContainerClass: function(flex) {
                return 'flex:' + flex.toString() + '%;'
            },

            isSimpleField: function(type) {
                return type !== 'email' && type !== 'tel' && type !== 'checkbox' && type !== 'list'
            },

            isPhone: function(type) {
                return type === 'tel'
            },

            isMail: function(type) {
                return type === 'email'
            },

            isCheckbox: function(type) {
                return type === 'checkbox'
            },

            isList: function(type) {
                return type === 'list'
            },

            setData: function(data) {
                this.formData = data;
            }
        });
    </script>
</dom-module>
